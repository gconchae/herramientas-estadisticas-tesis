<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramientas Estad√≠sticas - Tesis Doctoral</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            
            /* Colores de las Fases */
            --fase1-color: #27ae60; /* Verde */
            --fase2-color: #8e44ad; /* Morado */
            --inferencial-color: #f39c12; /* Naranja */
            --impacto-color: #e74c3c; /* Rojo */
            --apendice-color: #c0392b; /* Rojo oscuro */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 0 0 15px 15px;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .search-container {
            margin: 20px 0 30px;
            position: relative;
        }
        
        #toolSearch {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        #toolSearch:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }
        
        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }
        
        .phases-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }
        
        .phase-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-left: 6px solid var(--secondary-color);
        }
        
        .phase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
        }

        .phase-card.fase-1 { border-left-color: var(--fase1-color); }
        .phase-card.fase-2 { border-left-color: var(--fase2-color); }
        .phase-card.inferencial { border-left-color: var(--inferencial-color); }
        .phase-card.impacto { border-left-color: var(--impacto-color); }
        .phase-card.apendice { 
            border-left-color: var(--apendice-color);
            grid-column: 1 / -1; /* Ocupa todo el ancho */
        }
        
        .phase-card h3 {
            color: var(--primary-color);
            margin-bottom: 18px;
            font-size: 1.4rem;
        }
        
        .tools-list {
            list-style-type: none;
        }
        
        .tools-list li {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        
        .tools-list li:hover {
            background-color: #f8f9fa;
        }
        
        .tools-list li:last-child {
            border-bottom: none;
        }

        .tool-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            margin-right: 12px;
            font-weight: 600;
            color: white;
            min-width: 90px;
            text-align: center;
        }

        .fase-1 .tool-badge { background-color: var(--fase1-color); }
        .phase-card.fase-2 .tool-badge { background-color: var(--fase2-color); }
        .phase-card.inferencial .tool-badge { background-color: var(--inferencial-color); }
        .phase-card.impacto .tool-badge { background-color: var(--impacto-color); }
        .phase-card.apendice .tool-badge { background-color: var(--apendice-color); }
        
        .cta-banner {
            background: linear-gradient(135deg, var(--dark-color), var(--primary-color));
            color: white;
            text-align: center;
            padding: 40px 20px;
            border-radius: 15px;
            margin-top: 40px;
        }
        .cta-banner h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        .cta-banner p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 25px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        .cta-button {
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .cta-button:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Estilos del Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 1000; overflow-y: auto; padding: 20px; }
        .modal-content { background-color: white; margin: 40px auto; border-radius: 15px; width: 90%; max-width: 800px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); animation: modalAppear 0.3s ease-out; overflow: hidden; }
        @keyframes modalAppear { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .modal-header { background: linear-gradient(135deg, var(--primary-color), var(--dark-color)); color: white; padding: 25px 30px; position: relative; }
        .modal-header h2 { font-size: 1.8rem; margin-bottom: 5px; }
        .modal-definition { font-style: italic; opacity: 0.9; margin-top: 8px; font-size: 1rem; line-height: 1.5; }
        .modal-definition a { color: #aed6f1; text-decoration: underline; }
        .modal-tool-code, .modal-scale { background-color: rgba(255, 255, 255, 0.2); padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; display: inline-block; margin-top: 8px; margin-right: 10px; }
        .close-modal { position: absolute; top: 20px; right: 25px; font-size: 2rem; cursor: pointer; color: white; background: none; border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s; }
        .close-modal:hover { background-color: rgba(255, 255, 255, 0.2); }
        .modal-body { padding: 30px; }
        .info-section { margin-bottom: 30px; }
        .info-section:last-child { margin-bottom: 0; }
        .info-section h3 { color: var(--primary-color); margin-bottom: 15px; font-size: 1.3rem; padding-bottom: 8px; border-bottom: 2px solid #f0f0f0; }
        .info-section p, .info-section ul { margin-bottom: 15px; line-height: 1.7; }
        .info-section ul { padding-left: 20px; }
        .application-context { background-color: #e8f4fc; border-left: 4px solid var(--secondary-color); padding: 15px; border-radius: 6px; margin: 15px 0; }
        .interpretation-guide { background-color: #fef9e7; border-left: 4px solid var(--warning-color); padding: 15px; border-radius: 6px; margin: 15px 0; }
        .scale-info { background-color: #f4ecf7; border-left: 4px solid #8e44ad; padding: 15px; border-radius: 6px; margin: 15px 0; }
        
        .methodology-path { background-color: #f8f9fa; border-left: 4px solid var(--impacto-color); padding: 20px; border-radius: 8px; margin: 25px 0 15px; }
        .methodology-path h4 { color: var(--primary-color); margin-bottom: 20px; font-size: 1.2rem; }
        .path-steps { position: relative; }
        .path-steps::before { content: ''; position: absolute; left: 17px; top: 5px; bottom: 5px; width: 3px; background-color: #e0e0e0; z-index: 1; }
        .path-step { display: flex; align-items: flex-start; margin-bottom: 20px; position: relative; z-index: 2; }
        .path-step:last-child { margin-bottom: 0; }
        .step-number { flex-shrink: 0; width: 38px; height: 38px; border-radius: 50%; background-color: #bdc3c7; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; margin-right: 15px; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .path-step.current .step-number { background-color: var(--impacto-color); transform: scale(1.1); }
        .step-text { padding-top: 5px; }
        .step-text a { color: var(--secondary-color); text-decoration: none; font-weight: bold; border-bottom: 2px dashed #d6eaf8; transition: all 0.2s; }
        .step-text a:hover { background-color: #d6eaf8; border-bottom-style: solid; }
        .step-text ul { padding-left: 20px; margin-top: 10px;}

        .modal-navigation { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .nav-btn { padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .nav-btn:hover:not(:disabled) { background: #2980b9; transform: translateY(-2px); }
        .nav-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        .no-results { text-align: center; padding: 40px; color: #7f8c8d; display: none; }
        .formula-container { background: #f0f2f5; border: 1px solid #e0e4e8; padding: 20px; border-radius: 8px; margin: 15px 0; text-align: center; }
        .formula { font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.5rem; color: var(--primary-color); line-height: 1.8; }
        .formula-variables { text-align: left; font-size: 0.95rem; color: #555; max-width: 300px; margin: 15px auto 0; }
        .variable { font-family: 'Courier New', monospace; background: #e9ecef; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        /* Estilos del Acorde√≥n */
        .accordion-item { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
        .accordion-header { background-color: #f8f9fa; width: 100%; border: none; text-align: left; padding: 15px 20px; font-size: 1.2rem; font-weight: 600; color: var(--primary-color); cursor: pointer; position: relative; transition: background-color 0.2s; }
        .accordion-header:hover { background-color: #e9ecef; }
        .accordion-header::after { content: '+'; font-size: 1.8rem; color: var(--secondary-color); position: absolute; right: 20px; top: 50%; transform: translateY(-50%); transition: transform 0.3s ease; }
        .accordion-header.active::after { transform: translateY(-50%) rotate(45deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; background-color: white; padding: 0 20px; }
        .accordion-content h4 { color: var(--primary-color); margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; }
        .accordion-content ul { list-style-position: inside; padding-left: 10px; }
        .accordion-content li { margin-bottom: 10px; }
        .accordion-content code { background-color: #e9ecef; padding: 3px 6px; border-radius: 4px; font-family: 'Courier New', monospace; font-weight: bold; }

        @media (max-width: 900px) {
            .phases-container { grid-template-columns: 1fr; }
            .phase-card.apendice { grid-column: auto; }
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .modal-content { width: 95%; margin: 20px auto; }
            .modal-header, .modal-body { padding: 20px; }
            .modal-navigation { flex-direction: column; gap: 10px; }
            .nav-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Herramientas y Procedimientos Estad√≠sticos</h1>
            <p class="subtitle">Haga clic en cualquier herramienta a continuaci√≥n para obtener una explicaci√≥n detallada de cada una y su aplicaci√≥n en nuestro estudio.</p>
        </div>
    </header>
    
    <div class="container">
        <main>
            <div class="search-container">
                <input type="text" id="toolSearch" placeholder="Buscar herramientas estad√≠sticas...">
                <span class="search-icon">üîç</span>
            </div>
            
            <div class="no-results" id="noResults">
                <h3>No se encontraron herramientas</h3>
                <p>Intenta con otros t√©rminos de b√∫squeda</p>
            </div>
            
            <div class="phases-container" id="phasesContainer">
                <!-- Las tarjetas se generan din√°micamente -->
            </div>

            <div class="cta-banner">
                <h2>¬øListo para ver los Resultados?</h2>
                <p>Ahora que ha explorado el motor metodol√≥gico, le invitamos a descubrir los hallazgos, conceptos clave y la historia completa de la investigaci√≥n.</p>
                <a href="https://gconchae.github.io/conceptos-y-hallazgos/" class="cta-button" target="_blank">Explorar los Hallazgos</a>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalToolTitle"></h2>
                <div id="modalToolDefinition" class="modal-definition"></div>
                <div id="modalHeaderBadges"></div>
                <button class="close-modal" id="closeModal" aria-label="Cerrar ventana">&times;</button>
            </div>
            <div class="modal-body" id="modalToolBody"></div>
        </div>
    </div>

    <script>
        const studyContent = {
            'descriptives': {
                definition: "Son las herramientas que usamos para 'tomar una foto' inicial de nuestros datos. Nos dicen dos cosas clave: un valor 't√≠pico' (como el promedio) y qu√© tan 'dispersos' est√°n los dem√°s valores a su alrededor.",
                content: {
                    aplicacion: `<strong>¬øC√≥mo los usamos en el estudio?</strong> Para establecer nuestra <strong>l√≠nea base</strong>, usamos principalmente cuatro medidas:<ul><li><strong>Media (M):</strong> El promedio cl√°sico de los puntajes.</li><li><strong>Desviaci√≥n Est√°ndar (DE):</strong> Nos dijo qu√© tan dispersos estaban los puntajes alrededor de la media.</li><li><strong>Mediana (Mdn):</strong> El puntaje que se encuentra justo en el medio de todos los dem√°s.</li><li><strong>Rango Intercuart√≠lico (RIQ):</strong> Nos mostr√≥ la dispersi√≥n del 50% central de los estudiantes, una medida m√°s robusta.</li></ul>`,
                    interpretacion: `<strong>¬øQu√© nos dijeron?</strong> Primero, revelaron el perfil inicial de los estudiantes: <strong>actitudes altas, pero conocimiento y pr√°cticas moderadas</strong>, sugiriendo la 'brecha actitud-conducta'.<br><br>Pero lo m√°s importante fue que, al analizar la dispersi√≥n, notamos que los datos <strong>no eran 'normales'</strong>. Esto hizo que la <strong>Mediana y el Rango Intercuart√≠lico (RIQ)</strong> fueran nuestros indicadores m√°s fiables y los protagonistas de nuestro an√°lisis descriptivo. Incluimos la Media y la Desviaci√≥n Est√°ndar (DE) para poder comparar nuestros resultados con otros estudios, pero nuestra historia principal se basa en las medidas m√°s robustas.`
                }
            },
             'ordinal_data': {
                definition: "Son datos que tienen un orden claro, pero la distancia entre sus valores no es necesariamente uniforme. Piense en los puestos de una carrera: sabemos que 1¬∫ es mejor que 2¬∫, pero no sabemos si la diferencia de tiempo es la misma que entre el 2¬∫ y el 3¬∫.",
                content: {
                    aplicacion: `<strong>¬øD√≥nde estaban en nuestro estudio?</strong> ¬°En todas partes! Nuestras escalas de respuesta eran ordinales:<ul><li><strong>Likert de 1 a 4:</strong> Para las dimensiones Afectiva y Conductual.</li><li><strong>Claves 0, 0.5, 1:</strong> Para la dimensi√≥n Cognitiva, representando 'incorrecto', 'parcial' y 'correcto'.</li></ul>`,
                    interpretacion: `<strong>¬øPor qu√© es tan importante?</strong> Este tipo de datos rara vez sigue una 'curva de campana' perfecta. Reconocer la naturaleza ordinal de nuestros datos desde el principio fue la <strong>raz√≥n fundamental</strong> que nos guio hacia el uso de pruebas no param√©tricas, que son las herramientas correctas para este tipo de informaci√≥n.`
                }
            },
            'normality': {
                definition: "Esta prueba act√∫a como un 'guardi√°n' que examina nuestros datos para ver si se distribuyen de forma 'normal', es decir, si se parecen a la famosa 'curva de campana'.",
                hasScale: true,
                scale: 'p < 0.05 (No es Normal)',
                content: {
                    aplicacion: `<p><strong>¬øQu√© hicimos y por qu√©?</strong></p><p>Sabiendo que nuestros <a href="#" onclick="event.preventDefault(); openToolModal('ordinal_data')">datos eran ordinales</a>, ya sospech√°bamos que no ser√≠an 'normales'. Usamos la prueba de <strong>Shapiro-Wilk</strong> para confirmarlo formalmente. La elegimos por su alta precisi√≥n en muestras peque√±as como la de nuestro Grupo Control (n=26).</p>`,
                    interpretacion: `<p><strong>¬øQu√© encontramos y qu√© signific√≥?</strong></p><p>El resultado fue claro: la mayor√≠a de nuestros datos <strong>NO eran normales</strong> (obtuvimos un <a href="#" onclick="openFormulaGuide('interpretacion')">valor p</a> < .05).</p><p>Este fue el <strong>cruce de caminos metodol√≥gico</strong> de nuestra tesis. Nos prohibi√≥ usar pruebas est√°ndar (t-Student, ANOVA) y nos oblig√≥ a tomar la <strong>'ruta no param√©trica'</strong>, confirmando que era el camino correcto y m√°s robusto.</p>`,
                    conexiones: `<div class="methodology-path"><h4>Nuestra Decisi√≥n Cr√≠tica</h4><div class="path-steps"><div class="path-step current"><div class="step-number">1</div><div class="step-text"><strong>El Veredicto:</strong> La prueba de Shapiro-Wilk nos dijo que los datos no eran 'normales', confirmando lo esperado para datos ordinales.</div></div><div class="path-step"><div class="step-number">‚Üí</div><div class="step-text"><strong>La Consecuencia:</strong> Esto justific√≥ el uso de pruebas no param√©tricas como:<ul><li><a href="#" onclick="event.preventDefault(); openToolModal('mann-whitney')">Mann-Whitney</a></li><li><a href="#" onclick="event.preventDefault(); openToolModal('wilcoxon')">Wilcoxon</a></li><li><a href="#" onclick="event.preventDefault(); openToolModal('kruskal-wallis')">Kruskal-Wallis</a></li></ul></div></div></div></div>`
                }
            },
            'internal-consistency': { 
                definition: "Aqu√≠ verificamos si las preguntas de cada dimensi√≥n de la escala son consistentes entre s√≠. Es como comprobar si todos los miembros de un equipo est√°n trabajando para el mismo objetivo.",
                hasScale: true,
                scale: 'Œ±/œâ ‚â• 0.70 (Aceptable)',
                content: { 
                    aplicacion: `<strong>¬øQu√© hicimos?</strong> Usamos dos coeficientes estad√≠sticos (<a href="#" onclick="openFormulaGuide('simbologia')">Alfa de Cronbach (Œ±) y Omega de McDonald (œâ)</a>) para medir la "armon√≠a" interna de las preguntas en cada una de las tres dimensiones de la ECA.`,
                    interpretacion: `<strong>¬øQu√© encontramos?</strong> Descubrimos algo crucial. Mientras que las dimensiones <strong>Afectiva y Conductual</strong> mostraron una coherencia aceptable, la dimensi√≥n <strong>Cognitiva</strong> obtuvo una calificaci√≥n muy baja (Œ± = .387).<br><br>Esto fue un hallazgo metodol√≥gico clave: la parte de nuestra encuesta que med√≠a el conocimiento no era fiable. Por esta raz√≥n, declaramos sus resultados como <strong>no concluyentes</strong>.`
                }
            },
            'content-validity': {
                definition: "Este paso consiste en preguntar a expertos si las preguntas de nuestra encuesta son adecuadas y cubren todos los aspectos importantes del concepto que queremos medir.",
                hasScale: true,
                scale: 'I-CVI ‚â• 0.78 (Aceptable)',
                content: {
                    aplicacion: `<strong>¬øQu√© hicimos?</strong> Le pedimos a un panel de 3 expertos en educaci√≥n ambiental y psicometr√≠a que actuaran como "jueces" de nuestra Escala de Conciencia Ambiental (ECA). Cada uno evalu√≥ si las preguntas eran claras y relevantes.`,
                    interpretacion: `<strong>¬øQu√© encontramos?</strong> Obtuvimos una "calificaci√≥n" promedio de <strong>.883 sobre 1</strong> (I-CVI), lo cual es considerado excelente. En esencia, los expertos nos dieron su "sello de aprobaci√≥n", confirmando que nuestro instrumento estaba bien dise√±ado.<br><br><em>(Nota: El <strong>I-CVI</strong> no es una f√≥rmula compleja, sino el resultado de un proceso de conteo de acuerdos entre jueces, por eso no tiene una entrada dedicada en la gu√≠a de f√≥rmulas).</em>`
                }
            },
            'fidelity': {
                definition: "Mide hasta qu√© punto la intervenci√≥n se implement√≥ en la pr√°ctica tal y como fue dise√±ada en la teor√≠a. Es un control de calidad para la intervenci√≥n en s√≠ misma.",
                hasScale: true,
                scale: '‚â•80% de Adherencia (Aceptable)',
                content: {
                    aplicacion: `<strong>¬øQu√© hicimos?</strong> Durante las 8 semanas, llevamos una bit√°cora detallada para registrar si cada actividad planeada se realizaba, cu√°nto tiempo tomaba y si hab√≠a desviaciones. Nuestro objetivo era lograr al menos un 80% de fidelidad.`,
                    interpretacion: `<strong>¬øQu√© encontramos?</strong> Logramos una fidelidad de implementaci√≥n superior al 80%. Esto es crucial porque nos da confianza en que los efectos observados en los estudiantes se deben realmente a nuestra intervenci√≥n dise√±ada y no a una versi√≥n improvisada o incompleta de la misma.`
                }
            },
            'factor-analysis': {
                definition: "Esta es una prueba avanzada para verificar si nuestra teor√≠a sobre la estructura del constructo (el 'plano') coincide con la realidad de los datos que recolectamos (la 'construcci√≥n').",
                hasScale: true,
                scale: 'CFI/TLI > 0.90 | RMSEA < 0.08',
                content: {
                    aplicacion: `<strong>¬øQu√© hicimos?</strong> Nuestro "plano" te√≥rico dec√≠a que la conciencia ecol√≥gica se compone de tres dimensiones: Cognitiva, Afectiva y Conductual. Usamos el AFC para comprobar si las respuestas de los 89 estudiantes realmente se agrupaban de esa manera.`,
                    interpretacion: `<strong>¬øQu√© encontramos?</strong> El an√°lisis nos dio una "calificaci√≥n de ajuste" muy buena (<a href="#" onclick="openFormulaGuide('simbologia')">CFI</a>=.913 y <a href="#" onclick="openFormulaGuide('formulas')">RMSEA</a>=.037). Esto significa que la "construcci√≥n" (los datos) <strong>coincid√≠a con nuestro "plano"</strong>, validando el enfoque central de nuestra tesis. <br><br><em>(Nota: El t√©rmino <strong>DWLS</strong> se refiere al "motor" de c√°lculo que usamos porque nuestros datos eran <a href="#" onclick="event.preventDefault(); openToolModal('ordinal_data')">ordinales</a>, lo que hace el an√°lisis m√°s preciso).</em>`
                }
            },
            'mann-whitney': { 
                definition: "Esta es la prueba principal de nuestro 'juicio'. Nos permite responder a la pregunta m√°s importante: al final del estudio, ¬øel grupo que recibi√≥ la intervenci√≥n tuvo puntajes significativamente mejores que el grupo que no la recibi√≥?", 
                content: { 
                    aplicacion: `<strong>El 'Veredicto' Principal:</strong> La usamos para comparar los puntajes finales (postest) entre el Grupo Experimental y el Grupo Control. Por ejemplo, en la dimensi√≥n afectiva, el resultado fue claro (U=339.5, p<.001), indicando una diferencia muy significativa a favor del grupo que particip√≥ en las actividades.`, 
                    interpretacion: `<strong>¬øQu√© significa?</strong> Un <a href="#" onclick="openFormulaGuide('interpretacion')">valor p < .05</a> nos permiti√≥ concluir con confianza que la diferencia observada no fue por azar, sino un efecto real de nuestra intervenci√≥n pedag√≥gica.`,
                    conexiones: `<div class="methodology-path"><h4>Nuestra Ruta de An√°lisis</h4><div class="path-steps"><div class="path-step"><div class="step-number">1</div><div class="step-text"><strong>Punto de Partida:</strong> Verificamos que los datos no eran 'normales' con <a href="#" onclick="event.preventDefault(); openToolModal('normality')">Shapiro-Wilk</a>.</div></div><div class="path-step current"><div class="step-number">2</div><div class="step-text"><strong>Decisi√≥n Clave:</strong> Al necesitar comparar dos grupos independientes con esos datos, esta prueba era la herramienta correcta.</div></div><div class="path-step"><div class="step-number">3</div><div class="step-text"><strong>Medici√≥n Final:</strong> Cuantificamos la magnitud de esta diferencia con el <a href="#" onclick="event.preventDefault(); openToolModal('rosenthal')">r de Rosenthal</a>.</div></div></div></div>` 
                } 
            },
            'wilcoxon': { 
                definition: "Esta prueba es como un 'informe de progreso' personal. En lugar de comparar a los estudiantes con otros, los compara consigo mismos para responder: ¬øhubo una mejora significativa desde su propio punto de partida (pretest) hasta el final (postest)?", 
                content: { 
                    aplicacion: `<strong>El 'Antes y Despu√©s':</strong> La usamos exclusivamente dentro del Grupo Experimental. Por ejemplo, en la dimensi√≥n conductual, el resultado (W=424.50, p=.016) nos mostr√≥ que los estudiantes, despu√©s de la intervenci√≥n, reportaron realizar pr√°cticas ecol√≥gicas con una frecuencia significativamente mayor que antes.`, 
                    interpretacion: `<strong>¬øQu√© significa?</strong> Un <a href="#" onclick="openFormulaGuide('interpretacion')">valor p < .05</a> aqu√≠ confirma que el cambio observado dentro del grupo no fue una fluctuaci√≥n aleatoria, sino una tendencia de mejora real a lo largo del tiempo.`,
                    conexiones: `<div class="methodology-path"><h4>Nuestra Ruta de An√°lisis</h4><div class="path-steps"><div class="path-step"><div class="step-number">1</div><div class="step-text"><strong>Punto de Partida:</strong> Verificamos que los datos no eran 'normales' con <a href="#" onclick="event.preventDefault(); openToolModal('normality')">Shapiro-Wilk</a>.</div></div><div class="path-step current"><div class="step-number">2</div><div class="step-text"><strong>Decisi√≥n Clave:</strong> Al necesitar comparar dos momentos (antes y despu√©s) para las mismas personas, esta prueba era la herramienta correcta.</div></div><div class="path-step"><div class="step-number">3</div><div class="step-text"><strong>Medici√≥n Final:</strong> Cuantificamos la magnitud de este cambio con el <a href="#" onclick="event.preventDefault(); openToolModal('rosenthal')">r de Rosenthal</a>.</div></div></div></div>` 
                } 
            },
            'kruskal-wallis': { 
                definition: "Esta prueba funciona como nuestro 'control de calidad'. La usamos para responder una pregunta de validez crucial: ¬ølas diferencias que vemos se deben a nuestra intervenci√≥n, o podr√≠an ser simplemente porque los estudiantes estaban en diferentes aulas (8¬∞ Uno, 8¬∞ Dos, 8¬∞ Tres)?", 
                content: { 
                    aplicacion: `<strong>Buscando 'Variables Ocultas':</strong> La usamos para comparar los puntajes entre los tres cursos de octavo grado, tanto antes como despu√©s de la intervenci√≥n.`, 
                    interpretacion: `<strong>¬øQu√© encontramos?</strong> No encontramos ninguna diferencia significativa entre los cursos (todos los <a href="#" onclick="openFormulaGuide('interpretacion')">valores p</a> fueron > .36). ¬°Estas fueron excelentes noticias! Signific√≥ que el efecto observado era consistente en toda la muestra y no depend√≠a del aula espec√≠fica de los estudiantes, lo que le da mucha m√°s fuerza a nuestra conclusi√≥n de que la intervenci√≥n fue la que marc√≥ la diferencia.`,
                    conexiones: `<div class="methodology-path"><h4>Nuestra Ruta de An√°lisis</h4><div class="path-steps"><div class="path-step"><div class="step-number">1</div><div class="step-text"><strong>Punto de Partida:</strong> Verificamos que los datos no eran 'normales' con <a href="#" onclick="event.preventDefault(); openToolModal('normality')">Shapiro-Wilk</a>.</div></div><div class="path-step current"><div class="step-number">2</div><div class="step-text"><strong>Decisi√≥n Clave:</strong> Al necesitar comparar tres grupos independientes con esos datos, esta era la prueba correcta.</div></div><div class="path-step"><div class="step-number">3</div><div class="step-text"><strong>Siguiente Paso (Condicional):</strong> Si hubi√©ramos encontrado diferencias, habr√≠amos necesitado la <a href="#" onclick="event.preventDefault(); openToolModal('dunn')">Prueba de Dunn</a>.</div></div></div></div>`
                } 
            },
            'dunn': { 
                definition: "Piense en esta prueba como el trabajo de un 'detective' que solo se llama si la prueba anterior (Kruskal-Wallis) encuentra una diferencia general. Su trabajo es investigar m√°s a fondo para identificar exactamente qu√© pares de grupos son diferentes entre s√≠.", 
                content: { 
                    aplicacion: `<strong>¬øLa usamos? No. Y eso fue una buena noticia.</strong> Como nuestra <a href="#" onclick="event.preventDefault(); openToolModal('kruskal-wallis')">Prueba de Kruskal-Wallis</a> no encontr√≥ diferencias significativas entre los cursos, no fue necesario llamar al 'detective'.`, 
                    interpretacion: `El hecho de no necesitar esta prueba reforz√≥ nuestra conclusi√≥n de que los cursos eran homog√©neos y que las diferencias encontradas en el estudio se deb√≠an a la intervenci√≥n, no a particularidades de cada aula.`,
                    conexiones: `<div class="methodology-path"><h4>Nuestra Ruta de An√°lisis</h4><div class="path-steps"><div class="path-step"><div class="step-number">1</div><div class="step-text"><strong>Paso Previo:</strong> Se ejecuta una <a href="#" onclick="event.preventDefault(); openToolModal('kruskal-wallis')">Prueba de Kruskal-Wallis</a>.</div></div><div class="path-step current"><div class="step-number">2</div><div class="step-text"><strong>Condici√≥n de Uso:</strong> Se aplica esta prueba <strong>solo si</strong> el resultado anterior es significativo. Como no lo fue, no la usamos.</div></div></div></div>` 
                } 
            },
            'rosenthal': { 
                definition: "Piense en esta 'r' como una regla especializada. Mientras que la 'r' m√°s com√∫n (correlaci√≥n de Pearson) mide c√≥mo dos variables se mueven juntas, esta versi√≥n, llamada 'r de Rosenthal', tiene un trabajo muy espec√≠fico: medir el **tama√±o del impacto** de nuestra intervenci√≥n cuando usamos pruebas no param√©tricas.",
                hasScale: true, 
                scale: 'r ‚âà 0.1 (peque√±o) | ‚âà 0.3 (moderado) | ‚â• 0.5 (grande)', 
                content: { 
                    why_this_r: `<strong>¬øPor qu√© usamos esta 'r' espec√≠fica y no otra?</strong><p>Nuestro camino metodol√≥gico nos llev√≥ aqu√≠. Como la <a href="#" onclick="event.preventDefault(); openToolModal('normality')">Prueba de Shapiro-Wilk</a> nos indic√≥ que nuestros datos no eran 'normales', tuvimos que usar pruebas especiales no param√©tricas (<a href="#" onclick="event.preventDefault(); openToolModal('mann-whitney')">Mann-Whitney</a> y <a href="#" onclick="event.preventDefault(); openToolModal('wilcoxon')">Wilcoxon</a>).</p><p>Esas pruebas nos dicen *si* hay una diferencia, pero no *qu√© tan grande* es. El 'r de Rosenthal' es el compa√±ero perfecto para estas pruebas, ya que traduce sus resultados a una escala universal y f√°cil de entender de 'peque√±o', 'moderado' o 'grande'.</p>`,
                    interpretacion: `<strong>¬øC√≥mo interpretamos los valores en el estudio?</strong><p>Esta 'r' fue clave para entender la relevancia de nuestros hallazgos:</p><ul><li>Un <strong>r = 0.59</strong> en la dimensi√≥n afectiva nos dijo que el impacto de la intervenci√≥n en las actitudes fue <strong>grande</strong> y muy relevante.</li><li>Un <strong>r = 0.33</strong> en la dimensi√≥n conductual nos mostr√≥ un impacto <strong>moderado</strong>, lo que nos ayud√≥ a visualizar la persistencia de la 'brecha actitud-conducta'.</li></ul>`,
                    conexiones: `<div class="application-context"><p>Para ver c√≥mo se calcula matem√°ticamente, puede consultar la <a href="#" onclick="openFormulaGuide('formulas')">F√≥rmula Clave</a> en nuestra gu√≠a de referencia.</p></div>`
                } 
            },
            'cliff': { 
                definition: "Piense en Delta de Cliff (Œ¥) como una 'segunda opini√≥n' experta y muy robusta. Su gran ventaja es que es inmune a los valores extremos (outliers) y su resultado es muy f√°cil de interpretar en t√©rminos de probabilidad.",
                hasScale: true, 
                scale: '|Œ¥| ‚âà 0.147 (peque√±o) | ‚âà 0.33 (medio) | ‚â• 0.474 (grande)', 
                content: { 
                    why_this_tool: `<strong>¬øPor qu√© considerar esta medida?</strong><p>Mientras que el <a href="#" onclick="event.preventDefault(); openToolModal('rosenthal')">r de Rosenthal</a> es com√∫n, Delta de Cliff es t√©cnicamente superior para datos no normales porque no le afectan los puntajes at√≠picamente altos o bajos. Funciona como una 'competencia cabeza a cabeza': compara cada estudiante de un grupo con cada estudiante del otro y cuenta qui√©n 'gana' m√°s a menudo.</p>`,
                    interpretacion: `<strong>¬øC√≥mo se interpreta (y su equivalencia)?</strong><p>Su interpretaci√≥n es muy intuitiva. Un <strong>Œ¥ = 0.30</strong> significa que si eliges al azar un estudiante del Grupo Experimental, tiene un <strong>30% m√°s de probabilidad</strong> de tener un puntaje m√°s alto que un estudiante elegido al azar del Grupo Control.</p><p>Es el an√°logo no param√©trico de la famosa <strong>'d de Cohen'</strong>, que se usa para datos normales.</p>`,
                    role_in_study: `<strong>¬øQu√© papel jug√≥ en nuestro estudio?</strong><p>Lo usamos como una <strong>verificaci√≥n de robustez</strong> en nuestro plan de an√°lisis. Sus resultados confirmaron la magnitud de los efectos encontrados con 'r de Rosenthal', d√°ndonos doble confianza en nuestras conclusiones. Para mantener la simplicidad, reportamos 'r' en el texto principal, sabiendo que Œ¥ lo respaldaba.</p>`
                } 
            },
            'eta-squared': { 
                definition: "Piense en esta medida (Œµ¬≤) como la 'regla' especializada que usamos junto a la <a href='#' onclick=\"event.preventDefault(); openToolModal('kruskal-wallis')\">Prueba de Kruskal-Wallis</a>. Su √∫nico trabajo es decirnos qu√© tan grande fue el efecto general cuando comparamos tres o m√°s grupos a la vez.", 
                hasScale: true, 
                scale: 'Œµ¬≤ ‚âà 0.01 (peque√±o) | ‚âà 0.06 (moderado) | ‚â• 0.14 (grande)', 
                content: { 
                    why_this_tool: `<strong>¬øPor qu√© una medida diferente a 'r'?</strong><p>Porque cada prueba principal tiene su medida de tama√±o del efecto compa√±era. Mientras que 'r' se calcula a partir del estad√≠stico 'Z' (de Mann-Whitney/Wilcoxon), √âpsilon Cuadrado (Œµ¬≤) se calcula a partir del estad√≠stico 'H' de la prueba de Kruskal-Wallis.</p><p>Usamos Œµ¬≤ (√âpsilon) en lugar de la m√°s com√∫n Œ∑¬≤ (Eta) porque es una versi√≥n 'corregida' y m√°s precisa, lo que hace el resultado m√°s honesto.</p>`,
                    interpretacion: `<strong>¬øC√≥mo se interpreta?</strong><p>Se interpreta como un porcentaje. Imagina que todas las diferencias en los puntajes son un 'pastel' del 100%. Un <strong>Œµ¬≤ = 0.216</strong> en la dimensi√≥n afectiva nos dijo que un <strong>21.6%</strong> de la variabilidad en las actitudes de los estudiantes se explicaba por la diferencia entre haber recibido la intervenci√≥n o no. ¬°Eso es un efecto grande y confirma lo que vimos con 'r'!</p>`,
                    conexiones: `<div class="methodology-path"><h4>Nuestra Ruta de An√°lisis</h4><div class="path-steps"><div class="path-step"><div class="step-number">1</div><div class="step-text"><strong>An√°lisis Previo:</strong> Usamos la <a href="#" onclick="event.preventDefault(); openToolModal('kruskal-wallis')">Prueba de Kruskal-Wallis</a> para encontrar si exist√≠a una diferencia.</div></div><div class="path-step current"><div class="step-number">2</div><div class="step-text"><strong>Medici√≥n del Impacto:</strong> Al encontrar una diferencia, usamos esta medida espec√≠fica para cuantificar <strong>qu√© tan grande</strong> era.</div></div></div></div>` 
                } 
            },
            'formulas': { 
                definition: 'Una gu√≠a de referencia para las principales f√≥rmulas y notaciones estad√≠sticas utilizadas en esta investigaci√≥n.',
                content: {
                    full_content: `
                        <div class="accordion-item" id="accordion-simbologia">
                            <button class="accordion-header">Simbolog√≠a (Notaci√≥n)</button>
                            <div class="accordion-content">
                                <h4>S√≠mbolos Generales</h4>
                                <ul>
                                    <li><code>N</code>: Tama√±o de la poblaci√≥n total.</li>
                                    <li><code>n</code>: Tama√±o de la muestra o subgrupo.</li>
                                    <li><code>p</code>: Valor de significancia. Si <strong>p < .05</strong>, el resultado es estad√≠sticamente significativo.</li>
                                    <li><code>df</code>: Grados de libertad, un par√°metro t√©cnico de las pruebas.</li>
                                </ul>
                                <h4>Variables de Contraste</h4>
                                <ul>
                                    <li><code>U, W, H</code>: Estad√≠sticos de las pruebas U de Mann-Whitney, Wilcoxon y Kruskal-Wallis.</li>
                                    <li><code>œá¬≤</code> (Chi-cuadrado): Estad√≠stico usado en el AFC.</li>
                                </ul>
                                <h4>√çndices de Ajuste del Modelo (AFC)</h4>
                                <ul>
                                    <li><code>CFI / TLI</code>: √çndices de ajuste comparativo. Valores > .90 son buenos.</li>
                                    <li><code>RMSEA</code>: Error de aproximaci√≥n. Valores < .08 son buenos.</li>
                                </ul>
                                <h4>Estad√≠sticos de Tama√±o del Efecto</h4>
                                <ul>
                                    <li><code>r, Œ¥, Œµ¬≤</code>: Medidas de la magnitud pr√°ctica del efecto.</li>
                                    <li><code>Œ±, œâ</code>: Coeficientes de fiabilidad de la encuesta.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="accordion-item" id="accordion-formulas">
                            <button class="accordion-header">F√≥rmulas Clave</button>
                            <div class="accordion-content">
                                <h4>r de Rosenthal</h4>
                                <div class="formula-container"><div class="formula">r = Z / ‚àöN</div></div>
                                <h4>√âpsilon Cuadrado (para Kruskal-Wallis)</h4>
                                <div class="formula-container"><div class="formula">Œµ¬≤ = (H - k + 1) / (n - k)</div></div>
                                 <h4>RMSEA (Error de Aproximaci√≥n)</h4>
                                <div class="formula-container"><div class="formula">RMSEA = ‚àö((œá¬≤ - df) / (df * (N - 1)))</div></div>
                                <h4>Delta de Cliff (Conceptual)</h4>
                                <div class="formula-container"><div class="formula">Œ¥ = P(X > Y) - P(Y > X)</div></div>
                            </div>
                        </div>
                        <div class="accordion-item" id="accordion-interpretacion">
                            <button class="accordion-header">Gu√≠a R√°pida de Interpretaci√≥n</button>
                            <div class="accordion-content">
                                <h4>Significancia Estad√≠stica (valor p)</h4>
                                <p>Un <strong>valor p < .05</strong> nos dice que un resultado probablemente no es producto del azar.</p>
                                <h4>Magnitud Pr√°ctica (Tama√±o del Efecto)</h4>
                                <p>Nos dice qu√© tan importante es el resultado. Usamos los puntos de corte de Cohen:</p>
                                <ul>
                                    <li><strong>Grande:</strong> r ‚â• 0.50 | |Œ¥| ‚â• 0.47 | Œµ¬≤ ‚â• 0.14</li>
                                    <li><strong>Moderado:</strong> r ‚âà 0.30 | |Œ¥| ‚âà 0.33 | Œµ¬≤ ‚âà 0.06</li>
                                    <li><strong>Peque√±o:</strong> r ‚âà 0.10 | |Œ¥| ‚âà 0.147 | Œµ¬≤ ‚âà 0.01</li>
                                </ul>
                            </div>
                        </div>
                    `
                } 
            }
        };

        const phasesData = [
            { id: 'fase1', title: 'FASE 1: PREPARACI√ìN Y SUPUESTOS', type: 'fase-1', tools: [ { name: 'Estad√≠sticos Descriptivos', code: 'Media / Mediana', contentKey: 'descriptives' }, { name: 'Naturaleza de los Datos', code: 'Escala Ordinal', contentKey: 'ordinal_data' }, { name: 'Prueba de Normalidad', code: 'Shapiro-Wilk', contentKey: 'normality' } ] },
            { id: 'fase2', title: 'FASE 2: VALIDACI√ìN DEL ESTUDIO', type: 'fase-2', tools: [ { name: 'Revisi√≥n por Expertos', code: 'Validez Contenido', contentKey: 'content-validity' }, { name: 'Coherencia de Preguntas', code: 'Alfa / Omega', contentKey: 'internal-consistency' }, { name: 'Validaci√≥n de Estructura', code: 'AFC (RMSEA, CFI)', contentKey: 'factor-analysis' }, { name: 'Fidelidad de Intervenci√≥n', code: 'Adherencia ‚â•80%', contentKey: 'fidelity' } ] },
            { id: 'inferencial', title: 'AN√ÅLISIS INFERENCIAL: PRUEBAS DE CONTRASTE', type: 'inferencial', tools: [ { name: 'Comparando Grupos: ¬øFuncion√≥?', code: 'U de Mann-Whitney', contentKey: 'mann-whitney' }, { name: 'Midiendo el Cambio: ¬øMejoraron?', code: 'Prueba de Wilcoxon', contentKey: 'wilcoxon' }, { name: 'Control de Calidad: ¬øInfluy√≥ el Curso?', code: 'Kruskal-Wallis', contentKey: 'kruskal-wallis' }, { name: 'Investigaci√≥n a Fondo (si aplica)', code: 'Prueba de Dunn', contentKey: 'dunn' } ] },
            { id: 'impacto', title: 'AN√ÅLISIS DE IMPACTO: TAMA√ëO DEL EFECTO', type: 'impacto', tools: [ { name: 'Tama√±o del Efecto (2 Grupos)', code: 'r de Rosenthal', contentKey: 'rosenthal' }, { name: 'Tama√±o del Efecto (Robusto)', code: 'Delta de Cliff', contentKey: 'cliff' }, { name: 'Tama√±o del Efecto (+2 Grupos)', code: '√âpsilon Cuadrado (Œµ¬≤)', contentKey: 'eta-squared' } ] },
            { id: 'apendice', title: 'GU√çA DE F√ìRMULAS Y NOTACI√ìN', type: 'apendice', tools: [ { name: 'Formulario y Gu√≠a de Interpretaci√≥n', code: 'F√≥rmulas', contentKey: 'formulas' } ] }
        ];
        
        // El resto del script
        
        let currentToolIndex = 0;
        let allTools = [];
        let filteredTools = [];

        const phasesContainer = document.getElementById('phasesContainer');
        const toolModal = document.getElementById('toolModal');
        const modalToolTitle = document.getElementById('modalToolTitle');
        const modalToolDefinition = document.getElementById('modalToolDefinition');
        const modalHeaderBadges = document.getElementById('modalHeaderBadges');
        const modalToolBody = document.getElementById('modalToolBody');
        const closeModal = document.getElementById('closeModal');
        const toolSearch = document.getElementById('toolSearch');
        const noResults = document.getElementById('noResults');

        function renderPhaseCards(filter = '') {
            phasesContainer.innerHTML = '';
            let hasResults = false;
            
            phasesData.forEach(phase => {
                const filteredToolsInPhase = phase.tools.filter(tool => 
                    tool.name.toLowerCase().includes(filter) || 
                    tool.code.toLowerCase().includes(filter)
                );

                if (filteredToolsInPhase.length > 0) {
                    hasResults = true;
                    const card = document.createElement('div');
                    card.className = `phase-card ${phase.type}`;
                    
                    let toolsHTML = '<ul class="tools-list">';
                    filteredToolsInPhase.forEach(tool => {
                        toolsHTML += `
                            <li onclick="openToolModal('${tool.contentKey}')">
                                <span class="tool-badge">${tool.code}</span>
                                <span>${tool.name}</span>
                            </li>
                        `;
                    });
                    toolsHTML += '</ul>';
                    
                    card.innerHTML = `<h3>${phase.title}</h3>${toolsHTML}`;
                    phasesContainer.appendChild(card);
                }
            });
            
            allTools = phasesData.flatMap(phase => phase.tools);
            filteredTools = allTools.filter(tool => 
                tool.name.toLowerCase().includes(filter) || 
                tool.code.toLowerCase().includes(filter)
            );

            noResults.style.display = hasResults ? 'none' : 'block';
        }

        function openToolModal(contentKey) {
            toolModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            const toolContent = studyContent[contentKey];
            const phaseTool = allTools.find(t => t.contentKey === contentKey);
            
            modalToolTitle.textContent = phaseTool.name;
            modalToolDefinition.innerHTML = toolContent.definition;
            
            currentToolIndex = filteredTools.findIndex(t => t.contentKey === contentKey);
            
            let headerBadgesHTML = `<span class="modal-tool-code">${phaseTool.code}</span>`;
            if (toolContent.hasScale) {
                headerBadgesHTML += `<span class="modal-scale">${toolContent.scale}</span>`;
            }
            modalHeaderBadges.innerHTML = headerBadgesHTML;
            
            let modalContent = '';

            if (contentKey === 'formulas') {
                modalContent = toolContent.content.full_content;
            } else {
                 for (const [key, value] of Object.entries(toolContent.content)) {
                    let sectionTitle = '';
                    let className = 'application-context';
                    let contentHTML = `<div>${value}</div>`;

                    switch (key) {
                        case 'aplicacion': sectionTitle = 'Aplicaci√≥n en Nuestro Estudio'; break;
                        case 'why_this_r': sectionTitle = '¬øPor qu√© esta "r" y no otra?'; className = 'interpretation-guide'; break;
                        case 'why_this_tool': sectionTitle = '¬øPor qu√© esta herramienta espec√≠fica?'; className = 'interpretation-guide'; break;
                        case 'role_in_study': sectionTitle = '¬øQu√© papel jug√≥ en nuestro estudio?'; break;
                        case 'consideraciones': sectionTitle = 'Consideraciones Metodol√≥gicas'; className = 'interpretation-guide'; break;
                        case 'interpretacion': sectionTitle = 'Interpretaci√≥n de Nuestros Resultados'; break;
                        case 'conexiones': modalContent += value; continue;
                        default: continue;
                    }
                    modalContent += `<div class="info-section"><h3>${sectionTitle}</h3><div class="${className}">${contentHTML}</div></div>`;
                }
            }
            
            modalContent += `<div class="modal-navigation">
                <button id="prevTool" class="nav-btn" ${currentToolIndex <= 0 ? 'disabled' : ''}>‚Üê Anterior</button>
                <button id="nextTool" class="nav-btn" ${currentToolIndex >= filteredTools.length - 1 ? 'disabled' : ''}>Siguiente ‚Üí</button>
            </div>`;
            
            modalToolBody.innerHTML = modalContent;

            if (contentKey === 'formulas') {
                activateAccordion();
            }
            
            document.getElementById('prevTool')?.addEventListener('click', navigateToPrevTool);
            document.getElementById('nextTool')?.addEventListener('click', navigateToNextTool);
            
            closeModal.focus();
        }

        function activateAccordion() {
            const accordionHeaders = document.querySelectorAll('.accordion-header');
            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const currentlyActive = document.querySelector('.accordion-header.active');
                    if(currentlyActive && currentlyActive !== header) {
                        currentlyActive.classList.remove('active');
                        currentlyActive.nextElementSibling.style.maxHeight = null;
                        currentlyActive.nextElementSibling.style.padding = "0 20px";
                    }

                    header.classList.toggle('active');
                    const content = header.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        content.style.padding = "0 20px";
                    } else {
                        content.style.maxHeight = content.scrollHeight + 40 + "px";
                        content.style.padding = "20px";
                    }
                });
            });
        }

        function openFormulaGuide(sectionId) {
            openToolModal('formulas');
            setTimeout(() => {
                const accordionItem = document.getElementById(`accordion-${sectionId}`);
                if (accordionItem) {
                    const header = accordionItem.querySelector('.accordion-header');
                    if (header && !header.classList.contains('active')) {
                        header.click();
                    }
                    accordionItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 150); 
        }

        function navigateToPrevTool() { if (currentToolIndex > 0) { openToolModal(filteredTools[currentToolIndex - 1].contentKey); } }
        function navigateToNextTool() { if (currentToolIndex < filteredTools.length - 1) { openToolModal(filteredTools[currentToolIndex + 1].contentKey); } }
        function closeToolModal() { toolModal.style.display = 'none'; document.body.style.overflow = 'auto'; }
        
        closeModal.addEventListener('click', closeToolModal);
        toolModal.addEventListener('click', e => { if (e.target === toolModal) closeToolModal(); });
        toolSearch.addEventListener('input', e => renderPhaseCards(e.target.value.toLowerCase()));
        
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && toolModal.style.display === 'block') closeToolModal();
            if (toolModal.style.display === 'block') {
                if (e.key === 'ArrowLeft') navigateToPrevTool();
                if (e.key === 'ArrowRight') navigateToNextTool();
            }
        });

        window.openToolModal = openToolModal;
        window.openFormulaGuide = openFormulaGuide;
        
        document.addEventListener('DOMContentLoaded', () => {
            renderPhaseCards();
            
            // Script "Receptor" para enlaces contextuales
            const params = new URLSearchParams(window.location.search);
            const toolToOpen = params.get('tool');
            if (toolToOpen && studyContent[toolToOpen]) {
                // Peque√±o delay para asegurar que todo est√° renderizado
                setTimeout(() => {
                    openToolModal(toolToOpen);
                }, 100);
            }
        });
    </script>
</body>
</html>